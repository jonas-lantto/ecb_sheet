#!/usr/bin/env ruby
require 'table_transform'
require_relative '../lib/ecb_sheet'

begin
  option_parser = ECB_OptionParser.new(File.basename($PROGRAM_NAME))
  option_parser.parse(ARGV)

  period = option_parser.options['full_history'] ? :period_full : :period_90d
  currency_rates  = Currency_rates.new(period)
  option_parser.post_validate(currency_rates.get_available_dates, currency_rates.get_available_currencies)

  currency_date   = option_parser.options['date']
  src_currency    = option_parser.options['src_currency']
  target_currency = option_parser.options['target_currency']

  xls = TableTransform::ExcelCreator.new("fxrates #{src_currency}#{target_currency} #{currency_date}.xlsx")
  xls.add_tab("FxRates(ECB) #{target_currency} #{currency_date}", currency_rates.table_data_currency2rate2(currency_date, target_currency))
  xls.add_tab("FxRates(ECB) #{src_currency}#{target_currency}",  currency_rates.table_data_date2rate2(src_currency, target_currency))
  xls.create!

rescue
  puts $!.to_s
  puts option_parser.option_parser
  exit
end

